<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Amigo Brainerd — 2024 vs 2025 Partner Brief (Live)</title>
<link rel="icon" href="data:;base64,=">
<style>
  :root{ --ink:#e5e7eb; --ink-soft:#a3b0c2; --panel:rgba(15,23,42,.78); --line:rgb(51,65,85); }
  body{ background:#0b1220; color:var(--ink); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji"; }
  .card{ background:var(--panel); border-radius:1rem; padding:1rem 1.25rem; box-shadow:0 1px 2px rgba(0,0,0,.3); }
  .kpi{ font-size:1.6rem; font-weight:800; line-height:1.1; font-variant-numeric:tabular-nums; }
  .pill{ border:1px solid var(--line); padding:.2rem .5rem; border-radius:999px; font-size:.75rem; white-space:nowrap; }
  .btn{ padding:.5rem .8rem; border:1px solid var(--line); border-radius:.6rem; background:transparent; color:#e2e8f0; font-size:.9rem; white-space:nowrap;}
  .btn:hover{ background:rgba(148,163,184,.08); border-color:rgb(71,85,105); }
  .btn.primary{ border-color:rgb(37,99,235); }
  .btn.primary:hover{ background:rgba(37,99,235,.15); }
  .soft{ color:var(--ink-soft); }
  .mono{ font-variant-numeric:tabular-nums; }
  .grid-2{ display:grid; grid-template-columns:1.1fr .9fr; gap:1rem; }
  .grid-4{ display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:1rem; }
  @media (max-width:1200px){ .grid-2,.grid-4{ grid-template-columns:1fr; } }
  table{ width:100%; border-collapse:separate; border-spacing:0; }
  th,td{ padding:.5rem .6rem; border-bottom:1px solid rgba(148,163,184,.2); }
  th{ text-align:left; color:#cbd5e1; background:rgba(15,23,42,.95); position:sticky; top:0; z-index:1; }
  td.text-right{ text-align:right; }
  .pos{ color:#86efac; } .neg{ color:#fca5a5; }
  .wrap{ max-width:72rem; margin:0 auto; padding:1.5rem; }
  @media print{
    .noprint{ display:none !important; }
    body{ background:#fff; color:#111827; }
    .card{ background:#fff; border:1px solid #e5e7eb; box-shadow:none; }
  }
  /* simple utility stand-ins (since Tailwind loads after) */
  .flex{display:flex}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.mb-2{margin-bottom:.5rem}.space-y-6>*+*{margin-top:1.5rem}
  .text-xl{font-size:1.25rem;font-weight:700}.text-3xl{font-size:1.875rem;font-weight:800}
  .hidden{display:none}
</style>
</head>
<body class="min-h-screen">
<div class="wrap space-y-6">

  <!-- Header -->
  <header class="flex items-start justify-between gap-3">
    <div>
      <h1 class="text-3xl">Amigo Brainerd — Partner Brief</h1>
      <p class="soft">Live 2024 vs 2025 sales, deltas, and profit projections. Pulls straight from your published Google Sheet.</p>
    </div>
    <div class="noprint" style="display:flex;flex-wrap:wrap;gap:.5rem;align-items:end">
      <div>
        <label class="soft" style="font-size:.75rem;display:block">Google Sheet CSV URL</label>
        <input id="csvUrl" style="width:420px;background:#0f172a;border:1px solid #334155;border-radius:.55rem;padding:.4rem .6rem;color:#e2e8f0;">
      </div>
      <button id="btnSaveUrl" class="btn">Save URL</button>
      <button id="btnFetch" class="btn primary">Refresh Now</button>
      <label class="soft" style="font-size:.75rem;display:flex;align-items:center;gap:.4rem">
        <input id="autoRefresh" type="checkbox"> Auto-refresh every 5 min
      </label>
      <span id="fetchStamp" class="pill soft">Loading…</span>
      <span class="soft" style="font-size:.75rem">• or </span>
      <label class="btn" for="fileCsv" style="cursor:pointer;">Upload CSV</label>
      <input id="fileCsv" type="file" accept=".csv,text/csv" class="hidden">
      <button class="btn" onclick="window.print()">Print</button>
    </div>
  </header>

  <!-- KPI row -->
  <section class="grid-4">
    <div class="card">
      <div class="soft" style="font-size:.9rem">YTD Sales 2025</div>
      <div id="kYtd25" class="kpi mono">—</div>
      <div class="soft" style="font-size:.75rem"><span id="ytdMonths">Jan–Dec</span></div>
    </div>
    <div class="card">
      <div class="soft" style="font-size:.9rem">YTD Δ vs 2024</div>
      <div id="kYtdDelta" class="kpi mono">—</div>
      <div id="kYtdPct" class="soft" style="font-size:.75rem">—</div>
    </div>
    <div class="card">
      <div class="soft" style="font-size:.9rem">Yearly Δ (projected @ same pace)</div>
      <div id="kYearDelta" class="kpi mono">—</div>
      <div class="soft" style="font-size:.75rem">From your sheet projection</div>
    </div>
    <div class="card">
      <div class="soft" style="font-size:.9rem">Cost / Day (avg)</div>
      <div id="kCostPerDay" class="kpi mono">—</div>
      <div class="soft" style="font-size:.75rem">As reported</div>
    </div>
  </section>

  <!-- Charts row -->
  <section class="grid-2">
    <div class="card">
      <h2 class="text-xl mb-2">Sales — 2024 vs 2025</h2>
      <canvas id="lineSales" height="130"></canvas>
      <div class="soft" style="font-size:.75rem;margin-top:.5rem">Monthly totals, side-by-side.</div>
    </div>
    <div class="card">
      <h2 class="text-xl mb-2">Monthly Δ vs 2024</h2>
      <canvas id="barDelta" height="130"></canvas>
      <div class="soft" style="font-size:.75rem;margin-top:.5rem">Bars show 2025 − 2024 by month (labels include % change).</div>
    </div>
  </section>

  <!-- Profit projections -->
  <section class="card">
    <div style="display:flex;flex-wrap:wrap;gap:.75rem;align-items:end">
      <h2 class="text-xl">Profit Projection</h2>
      <div>
        <label class="soft" style="font-size:.9rem">Method</label>
        <select id="selMethod" style="background:#0f172a;border:1px solid #334155;border-radius:.55rem;padding:.4rem .6rem;color:#e2e8f0;">
          <option value="current">Based on Current Profit % (reported)</option>
          <option value="projected">Based on Projected Sales − Expenses (reported)</option>
        </select>
      </div>
      <label class="soft" style="font-size:.9rem;display:flex;align-items:center;gap:.4rem">
        <input id="chkSavings" type="checkbox"> Add projected savings +$15,000 (Jul–Dec)
      </label>
      <span id="projNote" class="pill soft">—</span>
    </div>
    <div class="grid-2" style="margin-top:.75rem">
      <div><canvas id="lineProfit" height="130"></canvas></div>
      <div><canvas id="barExpense" height="130"></canvas></div>
    </div>
  </section>

  <!-- Detail table -->
  <section class="card">
    <h2 class="text-xl mb-2">Detail (click headers to sort)</h2>
    <div style="max-height:360px;overflow:auto">
      <table id="tbl">
        <thead>
          <tr>
            <th data-sort="month">Month</th>
            <th data-sort="s24" class="text-right">Sales 2024</th>
            <th data-sort="s25" class="text-right">Sales 2025</th>
            <th data-sort="delta" class="text-right">Δ (25−24)</th>
            <th data-sort="pct" class="text-right">% Δ</th>
            <th data-sort="exp" class="text-right">Expenses</th>
            <th data-sort="p1" class="text-right">Profit (Current %)</th>
            <th data-sort="p2" class="text-right">Profit (Proj S−E)</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>

  <footer class="soft" style="font-size:.75rem">
    Your Google Sheet URL is embedded or can be overridden (top-right). Use <b>Save URL</b> and optionally enable auto-refresh.
  </footer>
</div>

<!-- External scripts (deferred) -->
<script src="https://cdn.tailwindcss.com" defer></script>
<script src="https://unpkg.com/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<script src="./app.js?v=8" defer></script>
</body>
</html>
